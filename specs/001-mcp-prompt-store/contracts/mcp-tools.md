# MCP Tool Contracts

**Date**: 2026-02-19  
**Feature**: 001-mcp-prompt-store

## Spec Traceability

| Tool | User Story | Functional Requirements |
|------|------------|------------------------|
| `add_prompt` | US-1 | FR-001, FR-001a, FR-001b, FR-006, FR-006a |
| `list_prompts` | US-1 | FR-002 |
| `get_prompt` | US-1 | FR-002a |
| `update_prompt` | US-1 | FR-004, FR-001a, FR-001b, FR-006a |
| `delete_prompt` | US-1 | FR-005 |
| `search_prompts` | US-2 | FR-003 |
| `filter_by_tags` | US-3 | FR-007 |
| `list_tags` | US-3 | FR-007a |

## Implementation Notes

- Uses `McpServer.tool()` with Zod schemas (SDK v1.x)
- SDK converts Zod schemas to JSON Schema automatically
- All responses wrapped in MCP content format: `{ content: [{ type: "text", text: JSON.stringify(result) }] }`
- Error responses include structured `{ error: { code, message } }` within the text content

## Tool: add_prompt

**Spec**: User Story 1 | FR-001, FR-001a, FR-001b, FR-006, FR-006a | **SQL**: [data-model.md](./data-model.md#create-prompt-with-tags)

**Description**: Store a new AI prompt with optional tags

### Zod Schema (Implementation)

```typescript
const addPromptSchema = {
  title: z.string().min(1).max(200).describe("Unique title for the prompt"),
  content: z.string().min(1).describe("Full prompt content"),
  tags: z.array(z.string().min(1).max(50).regex(/^[a-zA-Z0-9_-]+$/))
    .optional().default([])
    .describe("Optional array of tag names (alphanumeric, dash, underscore)"),
};
```

### JSON Schema (Generated by SDK)

```json
{
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "description": "Unique title for the prompt"
    },
    "content": {
      "type": "string",
      "minLength": 1,
      "description": "Full prompt content"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 50,
        "pattern": "^[a-zA-Z0-9_-]+$"
      },
      "description": "Optional array of tag names",
      "default": []
    }
  },
  "required": ["title", "content"]
}
```

### Success Response

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "Code Review Assistant",
  "created_at": "2026-02-19T10:30:00Z"
}
```

### Error Responses

```json
// DUPLICATE_TITLE
{
  "error": {
    "code": "DUPLICATE_TITLE",
    "message": "A prompt with this title already exists"
  }
}

// INVALID_TITLE
{
  "error": {
    "code": "INVALID_TITLE",
    "message": "Title must be 1-200 characters"
  }
}

// INVALID_TAG
{
  "error": {
    "code": "INVALID_TAG",
    "message": "Tag 'invalid tag!' contains invalid characters. Use only letters, numbers, dash, and underscore."
  }
}
```

---

## Tool: list_prompts

**Spec**: User Story 1 | FR-002 | **SQL**: [data-model.md](./data-model.md#list-prompts-paginated)

**Description**: List stored prompts with pagination

### Zod Schema (Implementation)

```typescript
const listPromptsSchema = {
  limit: z.number().int().min(1).max(100).default(10)
    .describe("Maximum number of prompts to return"),
  offset: z.number().int().min(0).default(0)
    .describe("Number of prompts to skip"),
};
```

### JSON Schema (Generated by SDK)

```json
{
  "type": "object",
  "properties": {
    "limit": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100,
      "default": 10,
      "description": "Maximum number of prompts to return"
    },
    "offset": {
      "type": "integer",
      "minimum": 0,
      "default": 0,
      "description": "Number of prompts to skip"
    }
  }
}
```

### Success Response

```json
{
  "prompts": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "title": "Code Review Assistant",
      "snippet": "You are a code reviewer. Analyze the following code for...",
      "tags": ["coding", "review"],
      "created_at": "2026-02-19T10:30:00Z",
      "updated_at": "2026-02-19T10:30:00Z"
    }
  ],
  "total": 25,
  "limit": 10,
  "offset": 0,
  "has_more": true
}
```

---

## Tool: get_prompt

**Spec**: User Story 1 | FR-002a | **SQL**: [data-model.md](./data-model.md#get-prompt-by-id)

**Description**: Retrieve full prompt content by ID

### Input Schema

```json
{
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Prompt UUID"
    }
  },
  "required": ["id"]
}
```

### Success Response

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "Code Review Assistant",
  "content": "You are a code reviewer. Analyze the following code for bugs, security issues, and improvements...",
  "tags": ["coding", "review"],
  "created_at": "2026-02-19T10:30:00Z",
  "updated_at": "2026-02-19T14:45:00Z"
}
```

### Error Response

```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "Prompt not found"
  }
}
```

---

## Tool: update_prompt

**Spec**: User Story 1 | FR-004 | **SQL**: [data-model.md](./data-model.md#update-prompt)

**Description**: Update an existing prompt's title, content, and tags

### Input Schema

```json
{
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Prompt UUID to update"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "description": "New title for the prompt"
    },
    "content": {
      "type": "string",
      "minLength": 1,
      "description": "New prompt content"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 50,
        "pattern": "^[a-zA-Z0-9_-]+$"
      },
      "description": "New array of tag names (replaces existing tags)"
    }
  },
  "required": ["id", "title", "content"]
}
```

### Success Response

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "Code Review Assistant v2",
  "updated_at": "2026-02-19T15:00:00Z"
}
```

### Error Responses

```json
// NOT_FOUND
{
  "error": {
    "code": "NOT_FOUND",
    "message": "Prompt not found"
  }
}

// DUPLICATE_TITLE
{
  "error": {
    "code": "DUPLICATE_TITLE",
    "message": "A prompt with this title already exists"
  }
}
```

---

## Tool: delete_prompt

**Spec**: User Story 1 | FR-005 | **SQL**: [data-model.md](./data-model.md#delete-prompt-cascade-removes-tag-associations)

**Description**: Permanently remove a prompt

### Input Schema

```json
{
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Prompt UUID to delete"
    }
  },
  "required": ["id"]
}
```

### Success Response

```json
{
  "deleted": true,
  "id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### Error Response

```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "Prompt not found"
  }
}
```

---

## Tool: search_prompts

**Spec**: User Story 2 | FR-003 | **SQL**: [data-model.md](./data-model.md#search-prompts-by-keyword)

**Description**: Search prompts by keyword in title or content

### Input Schema

```json
{
  "type": "object",
  "properties": {
    "query": {
      "type": "string",
      "description": "Search term (case-insensitive partial match)"
    },
    "limit": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100,
      "default": 10
    },
    "offset": {
      "type": "integer",
      "minimum": 0,
      "default": 0
    }
  },
  "required": ["query"]
}
```

### Success Response

```json
{
  "prompts": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "title": "Code Review Assistant",
      "snippet": "...review the code for bugs and...",
      "tags": ["coding", "review"],
      "created_at": "2026-02-19T10:30:00Z",
      "updated_at": "2026-02-19T10:30:00Z"
    }
  ],
  "total": 3,
  "query": "review",
  "limit": 10,
  "offset": 0,
  "has_more": false
}
```

---

## Tool: filter_by_tags

**Spec**: User Story 3 | FR-007 | **SQL**: [data-model.md](./data-model.md#filter-by-tags-or-logic)

**Description**: Filter prompts by one or more tags (OR logic)

### Input Schema

```json
{
  "type": "object",
  "properties": {
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "Array of tag names to filter by"
    },
    "limit": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100,
      "default": 10
    },
    "offset": {
      "type": "integer",
      "minimum": 0,
      "default": 0
    }
  },
  "required": ["tags"]
}
```

### Success Response

```json
{
  "prompts": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "title": "Code Review Assistant",
      "snippet": "You are a code reviewer...",
      "tags": ["coding", "review"],
      "created_at": "2026-02-19T10:30:00Z",
      "updated_at": "2026-02-19T10:30:00Z"
    }
  ],
  "total": 5,
  "matched_tags": ["coding", "review"],
  "limit": 10,
  "offset": 0,
  "has_more": false
}
```

---

## Tool: list_tags

**Spec**: User Story 3 | FR-007a | **SQL**: [data-model.md](./data-model.md#list-tags-with-counts)

**Description**: List all available tags with prompt counts

### Zod Schema (Implementation)

```typescript
const listTagsSchema = {};  // No input parameters
```

### JSON Schema (Generated by SDK)

```json
{
  "type": "object",
  "properties": {}
}
```

### Success Response

```json
{
  "tags": [
    {
      "name": "coding",
      "prompt_count": 15
    },
    {
      "name": "review",
      "prompt_count": 8
    },
    {
      "name": "writing",
      "prompt_count": 3
    }
  ],
  "total": 3
}
```

---

## Error Codes Summary

| Code | HTTP Equivalent | Description |
|------|-----------------|-------------|
| NOT_FOUND | 404 | Resource does not exist |
| DUPLICATE_TITLE | 409 | Prompt title already exists |
| INVALID_TITLE | 400 | Title validation failed |
| INVALID_TAG | 400 | Tag name validation failed |
| INVALID_INPUT | 400 | General input validation error |
